<!-- 0d00baa8-43d5-47c4-8d5c-10065de4e3cc b7042598-b0ba-4f21-8632-58b9867c8988 -->
# 新建会话时选择加入已有分组（下拉选择）

## 目标

- 在 `conversations.html` 点击“新建会话”后（用户确认保存当前会话），弹出模态对话框：询问是否将新会话加入已有分组，并提供下拉菜单列出 `conversationGroups`。
- 选择结果写入 `localStorage.deeps eekConversationGroupId`（未选择则移除该键）。
- 跳转到 `index.html` 后，首次发送时自动创建的持久会话条目将携带该分组（现有逻辑已支持）。

## 涉及文件

- `conversations.html`
- `style.css`
- （仅核对）`index.html`
- 文档：`README.md`、`README_zh.md`、`CURSOR.md`

## 变更点与实现要点

- conversations.html
  - 新增模态对话框（隐藏，DOM 结构写在 `<body>` 末尾）：
    - 标题：”是否将新会话加入已有分组？“
    - 下拉框：首项为“未加入分组”，其后按 `conversationGroups`（id、name）填充。
    - 按钮：`确认`（应用选择并进入新会话）、`跳过`（不设置分组直接进入新会话）、`取消`（关闭对话框，留在本页）。
  - `DOMContentLoaded` 时读取 `conversationGroups` 填充下拉菜单。
  - 调整“新建会话”按钮逻辑：
    - 仍先 `confirm('确定要开始新会话吗？当前会话会被保存。')`；确认后执行 `saveCurrentConversation('新会话')`。
    - 保存完成后，弹出分组选择模态；
    - `确认`：
      - 若选择“未加入分组”，`localStorage.removeItem('deepseekConversationGroupId')`；
      - 否则写入所选分组 id 至 `deepseekConversationGroupId`；
      - 同时重置临时会话状态：`deepseekConversation=[]`、`removeItem('deepseekConversationId')`；
      - 跳转 `index.html`。
    - `跳过`：不设置分组，执行与上面相同的重置并跳转。
    - `取消`：保持在本页不跳转。

- style.css
  - 新增简洁的模态与遮罩样式，避免影响现有布局（类名如 `.modal-overlay`, `.modal`, `.modal-actions`）。

- index.html
  - 仅核对：当前已在 `loadConversation()` 中读取 `deepseekConversationGroupId` 并用于首次持久化写入（创建条目时使用 `currentConversationGroupId`）。无需改动。

## 关键现有位置（将插入/改造）

```61:69:E:\NewWorkplace\13_FreeChat\conversations.html
document.getElementById('newChatBtn').addEventListener('click', () => {
    if (confirm('确定要开始新会话吗？当前会话会被保存。')) {
        saveCurrentConversation('新会话');
        // 清除临时会话与分组关联并跳转（此处将改为：弹出分组选择模态）
    }
});
```

## 数据约定

- 分组存储：`localStorage.conversationGroups` 数组项形如 `{ id, name, memorySummary, updatedAt }`。
- 新会话分组选择写入：`localStorage.deepseekConversationGroupId = <groupId|null>`。

## 兼容性与回退

- 若不存在任何分组：
  - 模态提示“当前没有可用分组”，仅提供“跳过/取消”。
- 未选择/跳过：等价于“未加入分组”。

## 验证步骤

1. 在 `conversations.html` 创建 2 个分组；
2. 点击“新建会话”→ 确认保存 → 弹出选择 → 选某分组“确认”；
3. 跳转 `index.html`，发送首条消息；
4. 检查 `savedDeepseekConversations` 新条目 `groupId` 是否为所选分组；
5. 重复一次选择“未加入分组”并验证。

### To-dos

- [ ] 在 conversations.html 添加分组选择模态与下拉菜单
- [ ] 改造新建会话点击流程以弹出模态并处理确认/跳过/取消
- [ ] 在 style.css 中添加模态与遮罩的基础样式
- [ ] 核对 index.html 加载分组与自动创建会话流程，无需改动则略过
- [ ] 更新 README.md/README_zh.md 说明新建会话分组选择；同步 CURSOR.md 主体与变更记录