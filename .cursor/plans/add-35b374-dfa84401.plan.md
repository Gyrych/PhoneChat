<!-- dfa84401-ab64-4fb1-b181-daf3c39618f8 d9ebd1b2-174e-4d4c-b912-70a47a37df04 -->
# 为主页面添加会话标题栏（可确认的实现计划）

概述：在 `index.html` 的主聊天区域顶部增加一个小型玻璃风格标题栏，显示“会话名称 + 分组名称”。优先使用现有设计令牌与玻璃样式，最小侵入性地修改 DOM 与样式，JS 端读取现有 localStorage 数据并在会话切换/保存时更新标题。

涉及文件（将修改）：

- `index.html` — 在合适位置插入标题栏 DOM（靠近已有抽屉开关/主内容容器）。
- `style.css` — 添加 `.session-title`、`.session-name`、`.session-group` 的样式（采用项目现有 `.glass` 风格令牌与响应式规则）。
- `index.html`（脚本部分）或 `script.js`（若项目将初始化逻辑抽离） — 新增 `renderSessionTitle()`，并在应用初始化与会话加载/保存函数中调用。
- `CURSOR.md` / `README.md` / `README_zh.md` — 同步更新文档中“界面风格/主要文件说明”段，说明新增头部展示会话名与分组。

关键行为与容错规则（实现细节）：

- 首选从 `savedDeepseekConversations` 中按 `deepseekConversationId` 找到会话并读取其 `.name` 与 `.groupId`；若找不到则回退到 `deepseekNewConversationName`、`currentConversation?.name` 或显示“未命名会话”。
- 分组名通过 `conversationGroups` 查找 `groupId` 得到 `.name`；若不存在显示“未分组”。
- 在会话创建/保存/加载逻辑中（例如 `saveConversation()`、`loadConversation()`、抽屉内的“加载会话”逻辑）触发 `renderSessionTitle()`；若有全局事件/回调机制（如 `onConversationChanged`），则订阅以保持同步。
- 可选：标题栏内“会话名”支持点击进入“重命名”模态（此项为增强功能，可后续开发）。

建议 UI（默认方案，最小侵入，遵循项目极简头部策略）：

- 位置：主聊天列顶部、输入区上方，与欢迎区/消息容器同列（非页面顶栏占位），在手机端为粘性但不遮挡输入区。
- 样式：高度 44px，左右内边距 12–16px，使用 `.glass` 令牌，文字垂直居中；会话名占主要空间，分组名为次要小字号并半透明显示。

关键代码片段（示例）——用于说明要插入/修改的最小代码：

HTML（插入 `index.html` 的合适位置）：

```html
<div id="sessionTitleBar" class="session-title glass" aria-hidden="false">
  <div class="session-name" id="sessionName">未命名会话</div>
  <div class="session-group" id="sessionGroup">未分组</div>
</div>
```

CSS（追加到 `style.css`）：

```css
.session-title {
  display: flex;
  flex-direction: column;
  gap: 2px;
  padding: 8px 14px;
  border-radius: var(--radius);
  backdrop-filter: var(--blur);
  background: rgba(255,255,255,0.6);
  box-shadow: var(--shadow);
  width: 100%;
  max-width: 860px;
  margin: 8px auto;
}
.session-name { font-size: var(--fs-h2); font-weight: 600; color: var(--fg); }
.session-group { font-size: 0.85rem; color: var(--muted); }
@media (max-width:600px) {
  .session-title { padding: 6px 10px; margin: 6px; }
  .session-name { font-size: 0.95rem; }
}
```

JS（新增 `renderSessionTitle()` 的核心示例，放在 `index.html` 的初始化逻辑或 `script.js`）：

```javascript
function renderSessionTitle() {
  const sessionNameEl = document.getElementById('sessionName');
  const sessionGroupEl = document.getElementById('sessionGroup');

  const savedConvs = JSON.parse(localStorage.getItem('savedDeepseekConversations') || '[]');
  const currentId = localStorage.getItem('deepseekConversationId');
  let sessionObj = savedConvs.find(c => c.id === currentId) || null;

  if (!sessionObj) {
    const tempName = localStorage.getItem('deepseekNewConversationName') || null;
    sessionObj = tempName ? { name: tempName, groupId: localStorage.getItem('deepseekConversationGroupId') } : null;
  }

  const name = sessionObj?.name || (window.currentConversation && window.currentConversation.name) || '未命名会话';
  const groups = JSON.parse(localStorage.getItem('conversationGroups') || '[]');
  const group = groups.find(g => g.id === (sessionObj?.groupId || localStorage.getItem('deepseekConversationGroupId')));
  const groupName = group?.name || '未分组';

  sessionNameEl.textContent = name;
  sessionGroupEl.textContent = groupName;
}

// 在应用初始化与会话保存/加载处调用
// initApp() -> renderSessionTitle();
// saveConversation()/loadConversation() -> renderSessionTitle();
```

文档更新：

- 在 `CURSOR.md` 的“界面风格”与“主要文件说明”处加入“主页面顶部会话标题栏”说明，并在末尾追加变更记录条目（遵循项目 CURSOR.md 的格式规则）。
- 如 README 与 README_zh.md 存在，也同步说明如何通过本地存储查看/修改会话名/分组。

回滚与兼容性考量：

- 本改动为前端视图增强，不改动本地存储结构；如需回退仅删除 DOM 与 CSS 并移除对 `renderSessionTitle()` 调用即可。

实现时间估算：

- 约 30–60 分钟完成（含样式微调与文档注记），若需要“会话名内联重命名”或“右侧编辑按钮”，额外 20–40 分钟。

请确认以下两项决策：

1. 标题栏位置/风格偏好？

  - a) 在主聊天列顶部，最小化（默认）
  - b) 页面顶栏（固定）

2. 是否需要会话名“内联可编辑（点击编辑）”功能？

  - a) 否（默认，仅显示）
  - b) 是（点击弹出重命名模态/内联编辑）

确认后我将按您选择的项生成具体编辑步骤并开始实施（先提交实现计划供您确认，然后再实际修改代码）。

### To-dos

- [ ] 在 `index.html` 中添加标题栏 DOM，并在 `style.css` 中添加相应样式
- [ ] 实现并接入 `renderSessionTitle()`，在初始化与会话保存/加载处调用以保证动态更新
- [ ] 同步更新 `CURSOR.md` 与 `README.md` / `README_zh.md`，在末尾追加变更记录