<!-- 5d68bac8-32bc-45d1-85b3-9d09432651b5 68bee8ff-2694-4a8c-99fa-b8c4ac7a1f7b -->
# 在会话页显示当前模型并支持思考过程折叠查看的改造计划

## 目标

- 在 `index.html` 顶部导航栏显示“当前模型”徽标（与 `localStorage.chatModel`/历史会话恢复的模型一致）。
- 在流式生成过程中，若 API 返回思考模型的推理内容（如 DeepSeek-R1），抓取并以“默认折叠”的方式在该轮助手消息下提供“思考过程”查看区。
- 同步更新 `style.css` 的必要样式与两份 README，以及 `CURSOR.md` 主体与变更记录。

## 涉及文件

- `index.html`
- `style.css`
- `README.md`、`README_zh.md`
- `CURSOR.md`

## 关键改动点

- 顶部徽标：在 header 中插入一个 `span#currentModelBadge.model-badge`，并在初始化与会话加载后更新显示。
- 推理流捕获：在流式解析时尝试读取可能的推理字段（如 `choices[0].delta.reasoning_content` 或 `choices[0].delta.reasoning?.content`），累积到 `reasoningBuffer`。
- 推理展示：在 `updateLastAssistantMessage` 中为最后一条助手消息追加“查看思考过程”切换控件（默认折叠，只有当捕获到推理文本时显示），内容使用 `DOMPurify` 消毒后渲染。
- 样式：为推理块添加简洁样式（如 `.reasoning-block`, `.reasoning-toggle`, `.reasoning-content`），复用现有配色风格；`model-badge` 直接复用现有样式。
- 文档：在 README（中/英）新增“当前模型徽标”与“思考过程查看”说明；在 `CURSOR.md` 主体记录数据流变化，并在变更记录追加本次修改条目。

## 参考锚点（便于实现时定位）

- 模型名初始化位置：
```85:88:e:\NewWorkplace\13_FreeChat\index.html
const MODEL_NAME = localStorage.getItem('chatModel') || 'minimax/minimax-m2:free';
window.MODEL_NAME = MODEL_NAME;
```

- 顶部 header（在此插入徽标元素）：
```40:48:e:\NewWorkplace\13_FreeChat\index.html
<header class="header">
  <button id="conversationsBtn" class="conversations-btn">...</button>
  <h1>FreeChat</h1>
  <button id="settingsBtn" class="settings-btn">...</button>
</header>
```

- 流式解析位置（在此同时累积 reasoning 片段）：
```475:483:e:\NewWorkplace\13_FreeChat\index.html
const json = JSON.parse(data);
const delta = json.choices && json.choices[0] && (json.choices[0].delta ? json.choices[0].delta.content : (json.choices[0].text || ''));
if (delta) {
  aiMsgObj.content += delta;
  updateLastAssistantMessage(aiMsgObj.content);
}
```


## 风险与兼容

- 不同供应商推理字段命名不完全一致，解析将“尽力而为”，未捕获时不展示推理区，不影响正常内容。
- 推理内容可能较长，默认折叠，避免干扰阅读；仅在有内容时渲染。

## 文档更新

- README（中/英）：功能说明与使用说明各增一小节，说明徽标与推理查看的行为与前置条件。
- CURSOR.md：补充数据流（推理捕获→渲染折叠区）与本次变更记录。

### To-dos

- [x] 在 index.html header 添加当前模型徽标并初始化/更新
- [ ] 在流式解析中捕获 reasoning_content/variants 并累积缓存
- [ ] 为最后一条助手消息渲染默认折叠的思考过程查看区
- [ ] 在 style.css 添加思考过程样式，复用现有配色
- [ ] 更新 README.md 与 README_zh.md，新增功能说明
- [ ] 更新 CURSOR.md 主体与变更记录，记录本次改造