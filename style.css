/* 引入 Inter 英文字体（英数优先），中文回退到系统字体 */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

/* 主题设计令牌（浅色 + 深色，统一实心卡片风格） */
:root {
    /* 颜色与视觉令牌 */
    --bg: #f6f7fb; /* 页面背景（浅冷白） */
    --bg-soft: #eef0f7; /* 次级背景色 */
    --fg: #1d1f23; /* 主文本颜色 */
    --muted: #5b6577; /* 次要文本颜色 */
    --brand: #4f46e5; /* 品牌主色（更新） */
    --brand-2: #06b6d4; /* 品牌渐变副色（更新） */
    --brand-soft: rgba(79,70,229,0.12); /* 品牌弱化背景 */
    --critical: #f97316; /* 重要提示色 */
    --success: #16a34a;
    --gloss: rgba(255,255,255,0.18); /* 光泽高光，用于按钮光效 */
    --surface: #ffffff;              /* 统一实心卡片背景 */
    --surface-strong: #f4f6fb;       /* 稍强的实心卡片背景 */
    --border: rgba(20,40,80,0.12); /* 细边 */
    --shadow: 0 8px 24px rgba(16,38,84,0.08); /* 阴影 */
    --radius: 14px; /* 圆角 */
    --blur: 12px; /* 玻璃模糊 */
    --gradient-soft: linear-gradient(135deg, rgba(79,70,229,0.12), rgba(6,182,212,0.12));
    /* 字体比例与行高 */
    --fs-body: clamp(15px, 1.5vw, 16px);
    --fs-h1: clamp(18px, 2.4vw, 22px);
    --fs-h2: clamp(16px, 2.0vw, 18px);
    --lh: 1.55;
    /* 触控与图标层级（移动端尺寸收敛） */
    --tap: 44px;           /* 触控最小尺寸 */
    --icon-lg: 1.25rem;    /* 主要图标（头部、附件） */
    --icon-md: 1.1rem;     /* 圆形主按钮内图标 */
    --icon-sm: 0.95rem;    /* 消息操作小图标 */
    /* 抽屉宽度（用于按钮跟随位移） */
    --drawer-width: min(92vw, 360px);
    /* 布局间距 */
    --gutter: clamp(12px, 2vw, 24px);
}

[data-theme="dark"] {
    --bg: #0f1117;
    --bg-soft: #161926;
    --fg: #f1f5f9;
    --muted: #a1acc4;
    --surface: #111827;
    --surface-strong: #020617;
    --border: rgba(255,255,255,0.08);
    --shadow: 0 20px 45px rgba(3,7,18,0.65);
    --gradient-soft: linear-gradient(135deg, rgba(79,70,229,0.18), rgba(6,182,212,0.18));
}

@media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
        background: radial-gradient(circle at top, #1c2030, #0f1117 60%);
        color: var(--fg);
    }
}

/* 通用组件与布局容器 */
.app-shell {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    background: radial-gradient(circle at 20% 20%, rgba(79,70,229,0.08), transparent 55%), var(--bg);
}

.app-shell main {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: var(--gutter);
    gap: var(--gutter);
}

.app-bar {
    width: 100%;
    padding: 12px var(--gutter);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    position: sticky;
    top: 0;
    z-index: 1200;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    box-shadow: 0 0 40px rgba(12,18,44,0.08);
}

.app-bar .app-brand {
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 0;
}

.app-brand .app-menu-btn {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.65);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    color: var(--fg);
    box-shadow: 0 4px 12px rgba(15,17,23,0.08);
}

.app-brand .app-menu-btn i {
    pointer-events: none;
}

.app-brand .brand-text {
    display: flex;
    flex-direction: column;
    gap: 2px;
    min-width: 0;
}

.app-bar .app-brand h1 {
    font-size: 1rem;
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.app-bar .app-context {
    display: flex;
    flex-direction: column;
    gap: 4px;
    min-width: 0;
}

.app-bar .app-actions {
    display: flex;
    align-items: center;
    gap: 10px;
}

.app-pill {
    padding: 2px 10px;
    border-radius: 999px;
    background: var(--brand-soft);
    color: var(--brand);
    font-size: 0.78rem;
    border: 1px solid rgba(79,70,229,0.15);
}

@media (max-width: 1200px) {
    .app-bar {
        gap: 10px;
    }
    .app-bar .app-brand {
        flex: 1;
    }
    .app-bar .app-context,
    .app-brand .app-pill {
        display: none;
    }
}

.chat-layout {
    display: grid;
    grid-template-columns: minmax(260px, 320px) minmax(0, 1fr);
    gap: var(--gutter);
    flex: 1;
    min-height: 0;
}

@media (max-width: 960px) {
    .chat-layout {
        grid-template-columns: 1fr;
        gap: clamp(10px, 3vw, 18px);
    }
}

.chat-drawer {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    box-shadow: var(--shadow);
    padding: 18px;
    display: flex;
    flex-direction: column;
    gap: 18px;
    max-height: calc(100vh - 140px);
    position: sticky;
    top: 90px;
    overflow: hidden;
}

.chat-drawer .drawer-footer {
    margin-top: auto;
}

.chat-drawer {
    transition: transform 0.25s ease;
}

@media (max-width: 960px) {
    .chat-drawer {
        position: fixed;
        inset: 0;
        width: 100%;
        max-width: 100%;
        height: 100%;
        border-radius: 0;
        padding: clamp(16px, 4vw, 28px);
        gap: 16px;
        transform: translateY(100%);
        z-index: 1300;
        max-height: none;
    }
    .chat-drawer.open {
        transform: translateY(0);
    }
    body:not(.drawer-open) .chat-drawer {
        pointer-events: none;
    }
    .drawer-overlay {
        background: rgba(0,0,0,0.55);
    }
}

.chat-drawer header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
}

.chat-drawer .drawer-search {
    width: 100%;
    border: 1px solid var(--border);
    border-radius: 999px;
    padding: 10px 14px;
    background: rgba(255,255,255,0.38);
}

.drawer-list {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding-bottom: 8px;
}

/* 侧边栏区域分组样式 */
.drawer-section {
    display: flex;
    flex-direction: column;
    margin-bottom: 8px;
}

.drawer-section-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    font-size: 0.9rem;
    color: var(--fg);
    background: rgba(79, 70, 229, 0.05);
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s;
    user-select: none;
}

.drawer-section-header:hover {
    background: rgba(79, 70, 229, 0.12);
}

.drawer-section-header i {
    font-size: 0.85rem;
}

.drawer-section-content {
    max-height: 300px;
    overflow-y: auto;
    padding: 8px 0;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.favorites-section .drawer-section-content.collapsed {
    max-height: 0;
    overflow: hidden;
    padding: 0;
}

.favorite-item {
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
}

.favorite-item:hover {
    transform: translateX(4px);
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.15);
}

.drawer-item {
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px;
    background: rgba(255,255,255,0.6);
    display: flex;
    flex-direction: column;
    gap: 6px;
    transition: border-color 0.2s, transform 0.2s;
}

.drawer-item.active {
    border-color: var(--brand);
    transform: translateX(4px);
    background: rgba(79,70,229,0.08);
}

.drawer-item .item-actions {
    display: flex;
    gap: 6px;
    justify-content: flex-end;
}

.chat-body {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    min-height: 0;
}

.chat-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    gap: 16px;
    flex-wrap: wrap;
}

.chat-header .session-meta {
    display: flex;
    flex-direction: column;
    gap: 6px;
    min-width: 0;
}

.chat-header .session-meta span {
    font-size: 0.88rem;
    color: var(--muted);
}

.chat-header .session-actions {
    display: flex;
    gap: 10px;
    align-items: center;
}

@media (max-width: 960px) {
    .app-bar {
        padding: 10px clamp(12px, 3vw, 18px);
        gap: 8px;
        align-items: center;
    }
    .app-context,
    .app-actions,
    .app-brand .app-pill {
        display: none;
    }
    .app-brand {
        flex: 1;
    }
    .app-brand .welcome-logo {
        width: 32px !important;
        height: 32px !important;
    }
    .chat-header {
        padding: 12px;
        border-radius: var(--radius);
        border: 1px solid var(--border);
        background: var(--surface);
    }
    .chat-body {
        border: none;
        box-shadow: none;
        background: transparent;
        padding: 0;
    }
    .welcome-hero {
        display: none;
    }
    .message-container {
        padding: 0 6px;
    }
    .input-container {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        border: 1px solid rgba(0,0,0,0.05);
        border-radius: 18px 18px 0 0;
        padding: 16px clamp(12px, 4vw, 22px);
        padding-bottom: calc(16px + env(safe-area-inset-bottom, 0px));
        background: rgba(255,255,255,0.96);
        box-shadow: 0 -10px 25px rgba(15,17,23,0.08);
        gap: 10px;
        z-index: 1500;
    }
    .composer-primary {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
    }
    .input-tools-main {
        flex: 1;
        justify-content: flex-start;
    }
    .input-tools-actions,
    .input-actions {
        flex-shrink: 0;
        justify-content: flex-end;
        align-items: center;
        gap: 8px;
    }
    .composer-meta {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
    }
    .token-meter {
        width: 100%;
        margin-right: 0;
    }
    .toast-stack {
        top: 76px;
        right: 12px;
        left: 12px;
    }
    .composer-tool-strip {
        width: 100%;
        justify-content: space-between;
        border-top: 1px solid rgba(0,0,0,0.06);
        padding-top: 10px;
    }
    .chat-drawer {
        padding-top: calc(16px + env(safe-area-inset-top, 0px));
        overflow-y: auto;
    }
    .message-container {
        padding-bottom: clamp(140px, 28vh, 220px);
    }
}

@media (max-width: 540px) {
    .app-brand .welcome-logo {
        display: none;
    }
    .brand-text h1 {
        font-size: 0.95rem;
        white-space: normal;
        text-overflow: clip;
    }
    .circle-btn {
        width: 42px;
        height: 42px;
    }
    .message-input {
        min-height: 60px;
    }
    .card-actions button,
    .bulk-buttons button,
    .input-tools button {
        min-width: 44px;
    }
}

.input-container {
    border-top: 1px solid var(--border);
    padding: 16px 20px;
    display: flex;
    flex-direction: column;
    gap: 14px;
    background: var(--surface-strong);
    border-bottom-left-radius: var(--radius);
    border-bottom-right-radius: var(--radius);
}

.composer-primary {
    width: 100%;
    display: flex;
    gap: 14px;
    align-items: flex-end;
}

.input-main {
    flex: 1;
    min-width: 220px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.message-input {
    width: 100%;
    min-height: 72px;
    max-height: 200px;
    border-radius: 16px;
    border: 1px solid var(--border);
    padding: 14px;
    resize: none;
    background: rgba(255,255,255,0.82);
    font-size: 1rem;
    line-height: 1.5;
}

.composer-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.82rem;
    color: var(--muted);
}

.token-strip {
    padding: 0 0 6px 0;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    gap: 10px;
}

.token-meter {
    flex: 1;
    height: 3px;
    border-radius: 999px;
    background: rgba(0,0,0,0.06);
    position: relative;
    overflow: hidden;
}

.token-meter span {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    border-radius: 999px;
    background: linear-gradient(90deg, var(--brand), var(--brand-2));
    width: 0%;
    transition: width 0.2s ease;
}
.token-meter span.critical {
    background: linear-gradient(90deg, var(--critical), #dc2626);
}

.token-count-label {
    font-size: 0.78rem;
    color: var(--muted);
    white-space: nowrap;
}

.input-tools {
    display: flex;
    gap: 10px;
}

.input-bottom {
    width: 100%;
}

.input-tools-main {
    display: flex;
    gap: 10px;
}

.input-tools-main button {
    flex: 0 0 auto;
}

.input-actions {
    display: flex;
    gap: 10px;
}

.composer-tool-strip {
    width: 100%;
    justify-content: flex-start;
    gap: 12px;
}

.composer-tool-strip button {
    flex: 0 0 auto;
}

.input-tools-scroll {
    gap: 12px;
}

.input-tools-scroll button {
    flex: 0 0 auto;
}

.input-tools-actions {
    align-items: flex-end;
    gap: 8px;
}

.circle-btn {
    width: var(--tap);
    height: var(--tap);
    border-radius: 14px;
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.55);
    color: var(--fg);
}

.status-bar {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 999px;
    padding: 10px 24px;
    box-shadow: var(--shadow);
    display: none;
    align-items: center;
    gap: 10px;
}

.status-bar.active {
    display: flex;
}

.toast-stack {
    position: fixed;
    top: 90px;
    right: var(--gutter);
    display: flex;
    flex-direction: column;
    gap: 12px;
    z-index: 1300;
}

.toast {
    min-width: 220px;
    padding: 12px 16px;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: var(--surface);
    box-shadow: var(--shadow);
    display: flex;
    align-items: flex-start;
    gap: 10px;
    animation: fadeIn 0.2s ease;
    transition: opacity 0.2s ease, transform 0.2s ease;
}

.toast.success { border-color: rgba(22,163,74,0.4); }
.toast.error { border-color: rgba(249,115,22,0.4); }
.toast.leaving { opacity: 0; transform: translateY(-6px); }

.empty-state {
    text-align: center;
    padding: 40px 20px;
    border: 1px dashed var(--border);
    border-radius: var(--radius);
    background: var(--gradient-soft);
    color: var(--muted);
}

.empty-state img {
    width: 120px;
    margin-bottom: 16px;
    opacity: 0.8;
}

/* 会话管理两栏布局 */
.conversation-layout {
    display: grid;
    grid-template-columns: minmax(220px, 280px) minmax(0, 1fr);
    gap: var(--gutter);
    min-height: 0;
}

@media (max-width: 900px) {
    .conversation-layout {
        grid-template-columns: 1fr;
    }
    .conversation-sidebar {
        order: 2;
        padding: 16px;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
    }
    .conversation-content {
        order: 1;
        padding: 0;
        border: none;
        box-shadow: none;
        background: transparent;
        gap: 16px;
    }
    .bulk-actions {
        position: sticky;
        top: calc(var(--gutter));
        background: var(--surface);
        border-radius: var(--radius);
        padding: 10px;
        box-shadow: 0 12px 28px rgba(15,17,23,0.12);
        z-index: 5;
    }
    .conversation-card {
        padding: 14px;
        gap: 12px;
    }
    .conversation-card .card-actions {
        justify-content: flex-start;
    }
}

.conversation-sidebar,
.conversation-content {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    box-shadow: var(--shadow);
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.group-panel {
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px;
    background: rgba(255,255,255,0.5);
}

.group-panel header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
}

.conversation-card {
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    background: rgba(255,255,255,0.65);
}

.conversation-card .card-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
}

.conversation-card.active {
    border-color: var(--brand);
    background: rgba(79,70,229,0.05);
}

.conversation-card .card-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    font-size: 0.85rem;
    color: var(--muted);
}

.conversation-card .card-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: flex-end;
}

.bulk-actions {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
}

.bulk-actions .pill {
    padding: 6px 14px;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.65);
    cursor: pointer;
}

.bulk-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

/* 会话管理页：批量操作按钮风格，复用主界面胶囊风格 */
.bulk-btn {
    padding: 6px 14px;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: #ffffff;
    color: var(--fg);
    font-size: 0.88rem;
    cursor: pointer;
    transition: background-color 0.16s ease, box-shadow 0.16s ease, transform 0.12s ease, border-color 0.16s ease;
}
.bulk-btn:hover:enabled {
    background: linear-gradient(135deg, #f3f5ff, #f7f9ff);
    box-shadow: 0 6px 14px rgba(16,38,84,0.12);
    transform: translateY(-1px);
}
.bulk-btn:disabled {
    opacity: 0.5;
    cursor: default;
    box-shadow: none;
}
.bulk-btn-danger {
    border-color: rgba(255,107,107,0.5);
    color: #c0392b;
}
.bulk-btn-danger:hover:enabled {
    background: linear-gradient(135deg,#fff5f6,#fff7f8);
}

/* 设置页 Stepper */
.config-shell {
    display: grid;
    grid-template-columns: minmax(220px, 280px) minmax(0, 1fr);
    gap: var(--gutter);
}

@media (max-width: 900px) {
    .config-shell {
        grid-template-columns: 1fr;
    }
}

.stepper {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    box-shadow: var(--shadow);
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.stepper-step {
    display: flex;
    gap: 12px;
    align-items: flex-start;
    padding: 12px;
    border-radius: 12px;
    border: 1px solid transparent;
}

.stepper-step.active {
    border-color: var(--brand);
    background: rgba(79,70,229,0.08);
}

.config-panel {
    max-width: 820px;
    margin: 0 auto;
    padding: 8px 0 24px 0;
    display: flex;
    flex-direction: column;
    gap: var(--gutter);
}

.config-grid.two-col {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
}

.config-summary,
.privacy-panel {
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 16px;
    background: rgba(255,255,255,0.65);
}

@media (max-width: 900px) {
    .config-shell {
        gap: var(--gutter);
    }
    .stepper {
        flex-direction: row;
        overflow-x: auto;
        padding: 12px;
    }
    .stepper-step {
        min-width: 180px;
        border: 1px solid rgba(0,0,0,0.05);
    }
    .config-panel {
        padding: 16px;
    }
    .config-grid.two-col {
        grid-template-columns: 1fr;
    }
}

/* 玻璃通用类（可复用到任意容器） */
.glass {
    background: var(--surface);
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
    border: 1px solid var(--border);
    box-shadow: var(--shadow);
}

/* 不支持 backdrop-filter 时的降级方案 */
@supports not (backdrop-filter: blur(1px)) {
    .glass { background: var(--surface-strong); }
}

/* 全局样式重置 */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "PingFang SC", "Microsoft YaHei", "Noto Sans CJK SC", "Open Sans", "Helvetica Neue", sans-serif;
}

body {
    background: linear-gradient(180deg, #f8faff, #f4f6fb);
    color: var(--fg);
    height: 100vh;
    display: flex;
    flex-direction: column;
    font-size: var(--fs-body);
    line-height: var(--lh);
}

/* 刘海/打孔屏安全区适配：为顶部预留安全区，避免品牌标题被摄像头/状态栏遮挡（Android/iOS WebView） */
@supports (padding-top: env(safe-area-inset-top)) {
    body { padding-top: env(safe-area-inset-top); }
}
@supports (padding-top: constant(safe-area-inset-top)) {
    body { padding-top: constant(safe-area-inset-top); } /* 兼容旧版 iOS 常量语法 */
}

/* 顶部导航栏 */
.header {
    /* 玻璃质感头部 */
    padding: 16px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 16px;
    margin: 8px 12px;
    border: 1px solid var(--border);
    box-shadow: var(--shadow);
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
    background: var(--surface);
    position: relative;
    z-index: 10;
}

.header h1 {
    font-size: var(--fs-h1);
    font-weight: 600;
    color: #1d1d1f;
}

/* 当头部需要居中标题（带返回按钮且标题居中）时使用此类 */
.header.title-centered {
    position: relative;
}
.header.title-centered h1 {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    margin: 0;
    text-align: center;
    width: calc(100% - 120px); /* 留出左右按钮空间，避免溢出 */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* 顶部标题与模型徽标上下排列容器 */
.header .brand {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

/* 头部品牌横排（Logo + 标题） */
.header .brand-line {
    display: flex;
    align-items: center;
    gap: 8px;
}
/* 品牌 Logo */
.header .brand .logo {
    height: 32px;
    width: auto;
    cursor: pointer;
    border-radius: 6px;
}

/* 使会话标题栏支持换行，模型徽章单独占一行并右对齐 */
.session-title {
  display: flex; /* 保持现有布局 */
  flex-wrap: wrap; /* 允许换行，将模型徽章推到下一行 */
  align-items: center;
  box-sizing: border-box;
}
.session-title > div { /* 会话名/分组容器可缩小避免挤压 */
  min-width: 0;
  flex: 1 1 auto;
}
.session-title .model-badge,
#currentModelBadge {
  flex-basis: 100%; /* 单独一行 */
  width: 100%;
  text-align: right; /* 右对齐（用户要求） */
  white-space: normal; /* 允许换行 */
  overflow-wrap: anywhere;
  word-break: break-word;
  box-sizing: border-box;
  margin-top: 6px; /* 与标题保持间距 */
}

.settings-btn, .back-btn, .conversations-btn, .new-chat-btn {
    background: rgba(255,255,255,0.55);
    border: 1px solid var(--border);
    color: #1d1d1f;
    font-size: 1.2rem;
    cursor: pointer;
    width: 40px;
    height: 40px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    transition: transform 0.18s ease, box-shadow 0.18s ease, background-color 0.18s ease;
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
}

.settings-btn:hover, .back-btn:hover, .conversations-btn:hover, .new-chat-btn:hover {
    background-color: rgba(255,255,255,0.75);
    box-shadow: 0 8px 18px rgba(16,38,84,0.10);
    transform: translateY(-1px);
}

/* 左上角悬浮的会话按钮（取代整条头部容器） */
.conversations-fab {
    position: fixed;
    left: 12px;
    top: 12px;
    z-index: 10000;
}
@supports (top: calc(env(safe-area-inset-top) + 12px)) {
    .conversations-fab { top: calc(env(safe-area-inset-top) + 12px); }
}
/* 抽屉打开时，按钮右移以避免遮挡抽屉内容 */
body.drawer-open .conversations-fab {
    left: calc(12px + var(--drawer-width));
}
@supports (left: calc(env(safe-area-inset-left) + 12px)) {
    .conversations-fab { left: calc(env(safe-area-inset-left) + 12px); }
    body.drawer-open .conversations-fab { left: calc(env(safe-area-inset-left) + 12px + var(--drawer-width)); }
}

/* 聊天内容区域 */
.chat-container {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

/* 会话标题栏：显示当前会话名称与分组（玻璃风格，响应式） */
.session-title {
    /* 三列布局：左按钮、中间信息、右模型徽章 */
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: 12px;
    padding: 8px 14px;
    border-radius: var(--radius);
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
    background: rgba(255,255,255,0.75);
    box-shadow: var(--shadow);
    width: 100%;
    max-width: 980px;
    margin: 10px auto;
    border: 1px solid rgba(0,0,0,0.06);
    position: sticky;
    top: calc(env(safe-area-inset-top, 12px) + 0px);
    z-index: 9999;
}
.session-title .session-info { display: flex; flex-direction: column; min-width: 0; }
.session-name { font-size: 1.05rem; font-weight: 600; color: var(--fg); line-height: 1; }
.session-group { font-size: 0.78rem; color: var(--muted); margin-top: 4px; }
.session-title .conversations-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--tap);
    height: var(--tap);
    border-radius: 10px;
    background: rgba(255,255,255,0.92);
    border: 1px solid rgba(0,0,0,0.06);
    color: #1d1d1f;
    cursor: pointer;
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
}
@media (max-width:600px) {
  .session-title { padding: 6px 10px; margin: 6px; top: calc(env(safe-area-inset-top) + 8px); }
  .session-name { font-size: 0.95rem; }
  .session-title .conversations-btn { width: 40px; height: 40px; }
}

.message-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

/* 消息样式（优化视觉，提升可读性） */
.message {
    max-width: min(860px, 88%); /* 放宽阅读宽度并限制超宽屏的最大片宽 */
    padding: 14px 18px;
    border-radius: 16px;
    line-height: 1.5; /* 适度行高，兼顾可读性与美观 */
    font-size: var(--fs-body);
    position: relative;
    animation: fadeIn 0.18s cubic-bezier(.22,.9,.35,1);
}

/* Markdown 渲染内容样式：限制宽度并确保换行、图片与表格自适应、代码块滚动 */
.message :where(p, ul, ol, blockquote, table, pre, code) {
    /* 优先使用 word-break 保证长文本/链接换行 */
    word-break: break-word;
    white-space: pre-wrap;
}

/* 列表样式：将前导符放在气泡内部并调整缩进，防止圆点超出边界 */
.ai-message ul,
.ai-message ol {
    margin: 6px 0; /* 减小列表上下间距 */
    padding-left: 18px; /* 视觉更和谐的缩进 */
    list-style-position: inside; /* 将圆点放到内容区域内 */
}

.ai-message li {
    margin: 4px 0; /* 减小列表项上下间距 */
    padding-left: 0; /* 清理额外内边距，避免双重缩进 */
}

/* 列表标记样式：统一颜色与大小，提升界面一致性 */
.ai-message li::marker {
    color: #0b3d91;
    font-size: 1em;
}

/* 段落与文本块微调 */
.message p {
    margin: 6px 0; /* 控制段落间距 */
}

.ai-message img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 8px 0;
    border-radius: 8px;
}

.ai-message pre {
    background: #0b1220;
    color: #e6eef8;
    padding: 12px;
    border-radius: 10px;
    overflow: auto;
    max-height: 320px; /* 限制代码块最大高度，避免整页被撑开 */
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
    font-size: 0.9rem;
    line-height: 1.4;
}

.ai-message code {
    background: rgba(27,31,35,0.06);
    padding: 2px 6px;
    border-radius: 6px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Courier New", monospace;
}

.ai-message table {
    width: 100%;
    border-collapse: collapse;
    margin: 8px 0;
}

.ai-message table th,
.ai-message table td {
    border: 1px solid rgba(0,0,0,0.06);
    padding: 8px 10px;
    text-align: left;
}

/* 增加右侧内边距，避免操作按钮遮挡消息内容 */
.message {
    padding-right: 48px;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(6px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ============ 复古打字机便签纸样式 ============ */

/* 便签纸卡片容器：包裹一对问答 */
.sticky-note-card {
    max-width: 100%;
    width: 100%;
    margin: 12px 0;
    padding: 24px 28px;
    background: linear-gradient(135deg, #fefaf0 0%, #fdf5e6 100%);
    border-radius: 4px;
    box-shadow:
        0 2px 4px rgba(139, 117, 77, 0.15),
        0 8px 16px rgba(139, 117, 77, 0.12),
        0 16px 32px rgba(139, 117, 77, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.5);
    position: relative;
    transform-origin: center top;
    animation: stickySlideIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    /* 纸张纹理效果 */
    background-image:
        repeating-linear-gradient(
            0deg,
            transparent,
            transparent 2px,
            rgba(139, 117, 77, 0.02) 2px,
            rgba(139, 117, 77, 0.02) 4px
        ),
        repeating-linear-gradient(
            90deg,
            transparent,
            transparent 2px,
            rgba(139, 117, 77, 0.015) 2px,
            rgba(139, 117, 77, 0.015) 4px
        ),
        linear-gradient(135deg, #fefaf0 0%, #fdf5e6 100%);
}

/* 交替旋转效果：增加真实感 */
.sticky-note-card:nth-child(odd) {
    transform: rotate(-0.5deg);
}

.sticky-note-card:nth-child(even) {
    transform: rotate(0.5deg);
}

.sticky-note-card:hover {
    transform: rotate(0deg) translateY(-2px);
    box-shadow:
        0 4px 8px rgba(139, 117, 77, 0.18),
        0 12px 24px rgba(139, 117, 77, 0.15),
        0 20px 40px rgba(139, 117, 77, 0.10),
        inset 0 1px 0 rgba(255, 255, 255, 0.6);
    transition: all 0.3s ease;
}

/* 便签进入动画：从底部打印出来 */
@keyframes stickySlideIn {
    0% {
        opacity: 0;
        transform: translateY(40px) scale(0.95);
    }
    60% {
        opacity: 0.8;
        transform: translateY(-4px) scale(1.01);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* 便签纸左上角折叠效果（装饰） */
.sticky-note-card::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 0 20px 20px 0;
    border-color: transparent #f5deb3 transparent transparent;
    filter: drop-shadow(-1px 1px 2px rgba(139, 117, 77, 0.3));
}

/* 用户问题区域：便签顶部 */
.sticky-question {
    font-size: 0.95rem;
    color: #5a4a3a;
    padding: 8px 12px;
    margin-bottom: 12px;
    background: rgba(139, 117, 77, 0.08);
    border-left: 3px solid #8b754d;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    line-height: 1.6;
    word-break: break-word;
}

/* 分隔线：虚线 */
.sticky-divider {
    height: 1px;
    background: repeating-linear-gradient(
        90deg,
        #8b754d,
        #8b754d 6px,
        transparent 6px,
        transparent 12px
    );
    margin: 16px 0;
    opacity: 0.4;
}

/* AI回复区域：便签主要内容 */
.sticky-answer {
    font-size: 1rem;
    color: #2a2520;
    line-height: 1.65;
    font-family: 'Georgia', 'Times New Roman', serif;
    word-break: break-word;
}

/* 便签内的代码块样式调整 */
.sticky-answer pre {
    background: #2a2520;
    color: #f5deb3;
    padding: 12px;
    border-radius: 4px;
    overflow: auto;
    max-height: 320px;
    font-family: 'Courier New', monospace;
    font-size: 0.88rem;
    line-height: 1.5;
    margin: 12px 0;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
}

.sticky-answer code {
    background: rgba(139, 117, 77, 0.12);
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
    color: #5a4a3a;
    font-size: 0.9em;
}

.sticky-answer pre code {
    background: transparent;
    padding: 0;
    color: inherit;
}

/* 便签底部元信息：模型标签、时间戳等 */
.sticky-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 16px;
    padding-top: 12px;
    border-top: 1px solid rgba(139, 117, 77, 0.15);
    font-size: 0.8rem;
    color: #8b754d;
    font-family: 'Courier New', monospace;
}

.sticky-model-label {
    opacity: 0.75;
}

.sticky-timestamp {
    opacity: 0.65;
    font-style: italic;
}

/* 便签内的操作按钮区域 */
.sticky-actions {
    display: flex;
    gap: 8px;
    justify-content: flex-end;
    margin-top: 12px;
}

.sticky-action-btn {
    background: rgba(139, 117, 77, 0.15);
    border: 1px solid rgba(139, 117, 77, 0.25);
    border-radius: 4px;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 0.85rem;
    color: #5a4a3a;
    transition: all 0.2s ease;
}

.sticky-action-btn:hover {
    background: rgba(139, 117, 77, 0.25);
    border-color: rgba(139, 117, 77, 0.4);
    transform: translateY(-1px);
}

.sticky-action-btn:active {
    transform: translateY(0);
}

/* 打字中效果：光标闪烁 */
.typing-cursor {
    display: inline-block;
    width: 2px;
    height: 1em;
    background: #5a4a3a;
    margin-left: 2px;
    animation: blink 1s step-end infinite;
    vertical-align: text-bottom;
}

@keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
}

/* ============ 打字机输入区域样式 ============ */

/* 输入区域改造为打字机外观 */
.input-container.typewriter-style {
    background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
    border-top: 3px solid #95a5a6;
    border-left: 3px solid #95a5a6;
    border-right: 3px solid #95a5a6;
    box-shadow:
        0 -4px 16px rgba(0, 0, 0, 0.3),
        inset 0 2px 4px rgba(255, 255, 255, 0.1);
    padding: 16px 20px;
}

.input-container.typewriter-style .message-input {
    background: #ecf0f1;
    border: 2px solid #7f8c8d;
    border-radius: 6px;
    font-family: 'Courier New', monospace;
    font-size: 1rem;
    color: #2c3e50;
    padding: 14px 18px;
    box-shadow:
        inset 0 2px 4px rgba(0, 0, 0, 0.15),
        0 1px 0 rgba(255, 255, 255, 0.2);
}

.input-container.typewriter-style .message-input:focus {
    border-color: #3498db;
    box-shadow:
        inset 0 2px 4px rgba(0, 0, 0, 0.15),
        0 0 0 3px rgba(52, 152, 219, 0.2);
}

/* 打字机风格的发送按钮 */
.input-container.typewriter-style .send-btn {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    box-shadow:
        0 4px 8px rgba(231, 76, 60, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

.input-container.typewriter-style .send-btn:hover {
    box-shadow:
        0 6px 12px rgba(231, 76, 60, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
}

/* ============ 响应式适配（移动端） ============ */

@media (max-width: 960px) {
    .sticky-note-card {
        max-width: 100%;
        width: 100%;
        padding: 18px 20px;
        margin: 10px 0;
    }

    .sticky-question {
        font-size: 0.9rem;
        padding: 6px 10px;
    }

    .sticky-answer {
        font-size: 0.95rem;
    }

    .sticky-meta {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
    }

    /* 移动端取消旋转效果，避免内容被裁切 */
    .sticky-note-card:nth-child(odd),
    .sticky-note-card:nth-child(even) {
        transform: rotate(0deg);
    }

    .sticky-note-card:hover {
        transform: rotate(0deg) translateY(-1px);
    }
}

/* ============ 保留原有消息样式作为备选 ============ */

.user-message {
    /* 用户消息采用品牌渐变，提升对比度 */
    background: linear-gradient(135deg, var(--brand), var(--brand-2));
    color: #ffffff;
    align-self: flex-end;
    border-bottom-right-radius: 4px;
    box-shadow: 0 6px 16px rgba(47,111,228,0.20);
}

.ai-message {
    /* AI 消息采用玻璃白面板 */
    color: #1d1d1f;
    align-self: flex-start;
    border-bottom-left-radius: 4px;
    border: 1px solid var(--border);
    background: var(--surface);
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
    box-shadow: var(--shadow);
}

/* 消息操作按钮 */
.message-actions {
    /* 流式排列，单独占一行并靠右对齐，默认可见 */
    position: static;
    display: flex;
    gap: 6px;
    justify-content: flex-end;
    margin-top: 8px;
    opacity: 1;
    transition: opacity 0.18s;
}

.message-model {
    color: var(--muted);
    font-size: 0.85rem;
    /* 单独一行并右对齐，限制在气泡宽度内，允许换行 */
    display: block;
    width: 100%;
    max-width: 100%;
    text-align: right;
    white-space: normal;
    overflow-wrap: anywhere;
    word-break: break-word;
    padding: 2px 6px;
    border-radius: 8px;
    background: rgba(255,255,255,0.0);
    box-sizing: border-box;
}

.action-btn {
    background: rgba(0, 0, 0, 0.1);
    border: none;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 0.7rem;
    color: inherit;
}

/* 图标字号统一（不改 DOM，仅调 <i> 的字号） */
.settings-btn i,
.conversations-btn i,
.attach-btn i { font-size: var(--icon-lg); }

.circle-btn i { font-size: var(--icon-md); }
.action-btn i { font-size: var(--icon-sm); }
.pill-toggle i { font-size: 1rem; }

.user-message .action-btn {
    background: rgba(255, 255, 255, 0.2);
}

/* 状态指示器 */
.status-indicator {
    height: 24px;
    margin: 8px 0;
    color: var(--muted);
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 8px;
    align-self: flex-start;
}

/* 加载动画 */
.loading-animation {
    display: flex;
    gap: 4px;
}

.loading-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background-color: #666;
    animation: bounce 1.4s infinite ease-in-out both;
}

.loading-dot:nth-child(1) { animation-delay: -0.32s; }
.loading-dot:nth-child(2) { animation-delay: -0.16s; }

@keyframes bounce {
    0%, 80%, 100% { transform: scale(0); }
    40% { transform: scale(1); }
}

/* 输入区域 */
.input-container {
    /* 输入区域改为不透明白底，避免半透明效果影响可读性 */
    background: #ffffff;
    padding: 12px 16px;
    display: flex;
    gap: 12px;
    box-shadow: var(--shadow);
    border-top: 1px solid var(--border);
    border-left: 1px solid var(--border);
    border-right: 1px solid var(--border);
    position: sticky;
    bottom: 0;
    z-index: 500;
}

.message-input {
    flex: 1;
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 12px 16px;
    resize: none;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.2s;
}

.message-input:focus {
    border-color: var(--brand);
}

/* 圆形主按钮通用样式 */
.circle-btn {
    color: white;
    border: none;
    border-radius: 50%;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s, filter 0.2s;
}

.send-btn {
    background: linear-gradient(135deg, var(--brand), var(--brand-2));
    position: relative;
    transition: transform 0.12s cubic-bezier(.2,.9,.3,1), box-shadow 0.18s ease, filter 0.12s ease;
    will-change: transform, box-shadow;
}

.send-btn:active {
    transform: scale(0.96);
}

.stop-btn {
    background: #e74c3c; /* 明确的停止语义色 */
    display: none; /* 默认隐藏，发送中显示 */
}

.send-btn:hover {
    filter: brightness(0.95);
}

.send-btn:disabled {
    background-color: #cccccc;
    cursor: not-allowed;
}

/* 发送中状态：旋转图标以提示加载（轻量、可被 reduced-motion 关闭） */
.send-btn.sending i {
    animation: spin 1s linear infinite;
    display: inline-block;
}
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

/* 发送按钮光泽高光与更细腻阴影 */
.send-btn {
    /* 保证已有背景渐变不被覆盖 */
    overflow: hidden;
}
.send-btn::after {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    background: linear-gradient(180deg, rgba(255,255,255,0.14), rgba(255,255,255,0.02));
    mix-blend-mode: overlay;
    opacity: 0.9;
    transition: opacity 0.18s ease, transform 0.18s ease;
}
.send-btn:hover::after { opacity: 1; transform: translateY(-2px); }
.send-btn:hover { box-shadow: 0 12px 30px rgba(79,70,229,0.12); transform: translateY(-1px); }

/* 可访问性的键盘焦点样式 */
.send-btn:focus-visible, .action-btn:focus-visible, .circle-btn:focus-visible, .attach-btn:focus-visible {
    outline: 2px solid rgba(79,70,229,0.18);
    outline-offset: 3px;
}

/* 消息轻微悬浮效果（鼠标/触控反馈） */
.message:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 30px rgba(16,38,84,0.06);
}

/* 消息操作按钮微交互 */
.action-btn {
    transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
}
.action-btn:hover { transform: translateY(-2px) scale(1.03); box-shadow: 0 6px 14px rgba(6,34,84,0.06); }

/* 内联胶囊开关（通用） */
.pill-toggle, .web-inline-toggle {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 0 12px;
    height: 36px;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.75);
    color: #08327a;
    cursor: pointer;
}
.pill-toggle .label, .web-inline-toggle .label { font-size: 0.9rem; }
.pill-toggle.active, .web-inline-toggle.active {
    background: linear-gradient(135deg, #e9f1ff, #f7faff);
    border-color: rgba(47,111,228,0.35);
    box-shadow: 0 6px 16px rgba(47,111,228,0.12) inset;
}

/* 附件按钮（与发送同高，非主动作） */
.attach-btn {
    background: rgba(255,255,255,0.75);
    border: 1px solid var(--border);
    width: 40px;
    height: 40px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

/* 联网搜索参数面板（玻璃风） */
.web-panel {
    position: fixed;
    top: 80px;
    right: 12px;
    width: min(92vw, 360px);
    padding: 12px 14px;
    border-radius: 12px;
    border: 1px solid var(--border);
    background: var(--surface);
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
    box-shadow: var(--shadow);
    z-index: 9999;
}

.web-panel-row { display: flex; align-items: center; gap: 8px; margin: 8px 0; }
.web-label { font-size: 0.9rem; color: var(--muted); }
.web-input {
    flex: 1;
    padding: 8px 10px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    background: #fff;
    font-size: 0.95rem;
}

/* 引用来源样式 */
.citations {
    margin-top: 10px;
    padding: 8px;
    border-radius: 10px;
    background: linear-gradient(90deg, rgba(240,248,255,0.6), rgba(250,250,255,0.8));
    border: 1px solid rgba(13,71,161,0.06);
    box-sizing: border-box;
}

/* 引用头部：作为折叠触发区域，样式与页面其它按钮统一 */
.citations-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    padding: 6px 8px;
    border-radius: 8px;
}
.citations-toggle {
    background: rgba(255,255,255,0.75);
    border: 1px solid var(--border);
    color: #08327a;
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9rem;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: background-color 0.12s, transform 0.12s;
}
.citations-toggle:hover { background-color: rgba(255,255,255,0.9); transform: translateY(-1px); }
.citations-toggle[aria-expanded="true"] { background: linear-gradient(90deg, #e6f0ff, #f0f7ff); border-color: #2f6fe4; color: #08327a; }

.citations-list {
    margin-top: 8px;
    padding-left: 18px;
    color: #122244;
}
.citations-list li { margin: 6px 0; }
.citations-list a { color: #0b3d91; text-decoration: underline; }

/* 配置页面样式 */
.config-container {
    flex: 1;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 24px;
}

.config-section {
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    box-shadow: var(--shadow);
    padding: 18px 20px;
    display: flex;
    flex-direction: column;
    gap: 14px;
}

.config-section + .config-section {
    margin-top: 4px;
}

.config-section-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--fg);
}

.config-section-desc {
    font-size: 0.86rem;
    color: var(--muted);
}

.config-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.config-label { font-size: 0.9rem; color: var(--muted); }

.config-hint {
    font-size: 0.8rem;
    color: var(--muted);
    margin-top: 2px;
}

.config-input {
    padding: 12px 16px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.2s;
}

.config-input:focus {
    border-color: #007aff;
}

/* 模型选择：保留原生 select 作为数据源并隐藏，自定义下拉样式用于可控展示（单行截断、搜索与触控高度） */
#modelSelect { display: none; font-size: 0.85rem; }
#modelSelect option { white-space: nowrap; }

/* 自定义下拉组件样式 */
.custom-select { position: relative; width: 100%; max-width: 100%; }
.custom-select__trigger {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  width: 100%;
  padding: 10px 12px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  background: #fff;
  cursor: pointer;
  font-size: 1rem;
  text-align: left;
}
.custom-select__value {
  display: inline-block;
  max-width: calc(100% - 36px);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.custom-select__panel {
  position: absolute;
  left: 0;
  right: 0;
  margin-top: 8px;
  /* 使用不透明白底，避免透明/玻璃效果造成可读性问题 */
  background: #ffffff;
  border: 1px solid var(--border);
  border-radius: 8px;
  box-shadow: 0 8px 20px rgba(16,38,84,0.08);
  z-index: 999;
  padding: 8px;
  display: none;
  max-height: 56vh;
  overflow: auto;
  opacity: 1;
}
.custom-select__panel[aria-hidden="false"] { display: block; }
.custom-select__search {
  width: 100%;
  padding: 8px 10px;
  margin-bottom: 8px;
  border-radius: 6px;
  border: 1px solid #e6e6e6;
  font-size: 0.95rem;
  outline: none;
}
.custom-select__options { list-style: none; padding: 0; margin: 0; }
.custom-select__options li {
  padding: 8px 10px;
  min-height: 44px; /* 触控目标 */
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  border-radius: 6px;
}
.custom-select__options li:hover { background: rgba(0,0,0,0.03); }
@media (max-width:600px) {
  .custom-select__trigger { font-size: 0.95rem; padding: 10px; }
  .custom-select__search { font-size: 0.95rem; padding: 8px; }
}

.config-save-btn {
    display: inline-block;
    width: 100%;
    margin-top: 20px;
    text-align: center;
}

.save-message {
    text-align: center;
    padding: 8px;
    font-size: 0.9rem;
}

.save-message.success {
    color: #34c759;
}

/* 会话管理页面样式 */
.conversations-container {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
}

.conversations-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

/* 科技感增强样式 */
.conversation-group summary {
    cursor: pointer;
    list-style: none;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 8px;
    background: linear-gradient(90deg, rgba(0,122,255,0.06), rgba(88,86,214,0.04));
    color: #0b3d91;
    font-weight: 600;
}

.conversation-group[open] summary {
    background: linear-gradient(90deg, rgba(0,122,255,0.1), rgba(88,86,214,0.06));
    box-shadow: 0 4px 16px rgba(13,71,161,0.06);
}

.conversation-group {
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid rgba(13,71,161,0.06);
}

.group-list {
    padding: 10px 12px 18px 12px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.8), rgba(245,248,255,0.6));
}

/* 分组创建控件美化 */
.group-controls {
    display: flex;
    gap: 8px;
    align-items: center;
    margin: 12px 0;
}

#newGroupName {
    flex: 1;
    padding: 10px 14px;
    border-radius: 10px;
    border: 1px solid rgba(13,71,161,0.08);
    background: linear-gradient(180deg, #ffffff, #fbfdff);
    box-shadow: 0 4px 12px rgba(6,34,84,0.03) inset;
    outline: none;
    font-size: 0.95rem;
}

#newGroupName:focus {
    border-color: rgba(13,71,161,0.22);
    box-shadow: 0 6px 18px rgba(13,71,161,0.06);
}

#createGroupBtn {
    background: linear-gradient(90deg,#2f6fe4,#5b8cff);
    color: white;
    border: none;
    padding: 10px 14px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 8px 20px rgba(47,111,228,0.12);
    transition: transform 0.12s ease, box-shadow 0.12s;
}

#createGroupBtn:hover { transform: translateY(-2px); box-shadow: 0 14px 30px rgba(47,111,228,0.16); }

.conversation-item {
    /* 会话卡片玻璃化 */
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px;
    display: flex;
    flex-wrap: wrap; /* 允许内联元素换行，以便摘要独占一行 */
    justify-content: space-between;
    align-items: flex-start; /* 顶部对齐，避免摘要被垂直居中压缩 */
    box-shadow: var(--shadow);
    transition: transform 0.12s ease, box-shadow 0.12s ease, background-color 0.12s ease;
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
}

.conversation-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 28px rgba(6,34,84,0.12);
}

.conversation-name { color: #082a8a; font-weight: 700; }
.conversation-time { color: #4b5563; }

.conversation-actions button { border-radius: 8px; padding: 8px 10px; }

.toggle-summary-btn, .view-memory-btn {
    background: rgba(13,71,161,0.06);
    border: 1px solid rgba(13,71,161,0.12);
    color: #08327a;
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
}

/* 分组操作图标按钮美化 */
.group-rename-btn, .group-delete-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: 1px solid rgba(13,71,161,0.12);
    background: white;
    color: #08327a;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(6,34,84,0.04);
    transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s;
}

/* 分组重新摘要按钮 */
/* 分组记忆重新生成按钮 */
.group-regen-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: 1px solid rgba(13,71,161,0.12);
    background: white;
    color: #08327a;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(6,34,84,0.04);
    transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s;
}
.group-regen-btn:hover { transform: translateY(-2px); background: linear-gradient(90deg,#f0f7ff,#f7f9ff); }

.group-rename-btn:hover { transform: translateY(-2px); background: linear-gradient(90deg,#f0f7ff,#f7f9ff); }
.group-delete-btn { border-color: rgba(255,107,107,0.2); color: #c0392b; }
.group-delete-btn:hover { transform: translateY(-2px); background: linear-gradient(90deg,#fff5f6,#fff7f8); }

.conversation-summary-content,
.group-memory {
    /* 确保在抽屉内与分组记忆宽度一致，跟随父容器宽度（--drawer-width） */
    width: 100%;
    box-sizing: border-box; /* 保证内边距不影响总宽度 */
    max-width: 100%;        /* 不超过父容器 */
    margin: 6px 0;          /* 统一上下间距，避免 inline style 导致差异 */
    background: linear-gradient(90deg, rgba(240,248,255,0.6), rgba(250,250,255,0.8));
    border-radius: 8px;
    padding: 10px;
    color: #122244;
    border: 1px solid rgba(13,71,161,0.04);
}

/* 保持分组记忆的左侧视觉指示（之前为 inline style） */
.group-memory {
    border-left: 2px solid #eee;
}

/* 会话记忆在显示时独占一行（不与操作按钮同行） */
.conversation-summary-content {
    flex-basis: 100%;
    width: 100%;
    box-sizing: border-box;
}

/* 思考过程折叠显示（默认隐藏，点击切换） */
.reasoning-block {
    margin-top: 8px;
}

.reasoning-toggle {
    background: rgba(13,71,161,0.06);
    border: 1px solid rgba(13,71,161,0.12);
    color: #08327a;
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.85rem;
}

.reasoning-content {
    background: linear-gradient(90deg, rgba(240,248,255,0.6), rgba(250,250,255,0.8));
    border-radius: 8px;
    padding: 10px;
    color: #122244;
    border: 1px solid rgba(13,71,161,0.04);
    margin-top: 6px;
}

/* 优化按钮图标样式 */
.load-btn, .delete-conv-btn { padding: 8px 12px; border-radius: 8px; }
.load-btn { background: linear-gradient(90deg, #e6f0ff, #f0f7ff); border-color: #2f6fe4; }
.delete-conv-btn { background: linear-gradient(90deg, #fff5f6, #fff7f8); border-color: #ff6b6b; }

.conversation-item {
    background-color: white;
    border-radius: 10px;
    padding: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.conversation-info {
    flex: 1 1 auto;
    min-width: 0; /* 允许在 flex 布局中正确收缩，防止内容溢出 */
}

.conversation-name {
    font-size: 1rem;
    font-weight: 500;
    margin-bottom: 4px;
}

/* 会话模型徽标样式 */
.model-badge {
    /* 胶囊玻璃徽标 */
    display: inline-block;
    font-size: 12px;
    color: #08327a;
    background: rgba(255,255,255,0.55);
    border: 1px solid var(--border);
    padding: 2px 8px;
    border-radius: 999px;
    margin-left: 6px;
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
}

/* 记忆状态徽章（右上） */
.memory-badge {
    display: inline-block;
    font-size: 12px;
    color: #08327a;
    background: rgba(255,255,255,0.6);
    border: 1px solid var(--border);
    padding: 4px 10px;
    border-radius: 999px;
    margin-left: 8px;
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
    display: none; /* 无任务时隐藏 */
    align-items: center;
}

.memory-spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    /* 半圆环：上半蓝，下半灰 */
    background: conic-gradient(#007aff 0deg 180deg, rgba(0,0,0,0.08) 180deg 360deg);
    position: relative;
    margin-right: 6px;
    vertical-align: middle;
}

.memory-spinner.spinning {
    animation: memory-spin 1s linear infinite;
}

@keyframes memory-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* 通用 SVG 圆环加载器样式（更美观、通用） */
.memory-spinner-svg {
    width: 18px;
    height: 18px;
    display: inline-block;
    vertical-align: middle;
}
.memory-spinner-svg .path {
    stroke: #007aff;
    stroke-linecap: round;
    stroke-dasharray: 60;
    stroke-dashoffset: 60;
    transform-origin: 50% 50%;
    transform-box: fill-box;
    animation: spinner-rotate 2s linear infinite, spinner-dash 1.2s ease-in-out infinite;
}
@keyframes spinner-rotate {
    100% { transform: rotate(360deg); }
}
@keyframes spinner-dash {
    0% { stroke-dashoffset: 60; }
    50% { stroke-dashoffset: 18; }
    100% { stroke-dashoffset: 60; }
}

/* 完成态：静态圆环（带勾）大小控制 */
.memory-done {
    width: 18px;
    height: 18px;
    display: inline-block;
    vertical-align: middle;
}
.memory-done circle { opacity: 0.98; }

.conversation-time {
    font-size: 0.8rem;
    color: #666;
}

.conversation-actions {
    display: flex;
    gap: 8px;
}

.load-btn, .delete-conv-btn {
    background: none;
    border: 1px solid #e0e0e0;
    border-radius: 6px;
    padding: 6px 10px;
    cursor: pointer;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 4px;
    transition: all 0.2s;
}

.load-btn {
    color: #007aff;
    border-color: #007aff;
}

.load-btn:hover {
    background-color: #f0f7ff;
}

.delete-conv-btn {
    color: #ff3b30;
    border-color: #ff3b30;
}

.delete-conv-btn:hover {
    background-color: #fff0f0;
}

.no-conversations {
    text-align: center;
    padding: 40px 20px;
    color: #666;
    font-size: 0.9rem;
}

.save-current-btn {
    display: block;
    width: 100%;
    margin-top: 16px;
    text-align: center;
}

.new-chat-btn {
    background: none;
    border: none;
    color: #1d1d1f;
    font-size: 1.2rem;
    cursor: pointer;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s;
}

.new-chat-btn:hover {
    background-color: #f0f0f0;
}

/* 移动端整体尺寸与间距收敛（适中风格） */
@media (max-width: 600px) {
    /* 头部内边距轻度压缩 */
    .header { padding: 12px 16px; }
    /* 移动端缩小 Logo 高度以协调视觉 */
    .header .brand .logo { height: 28px; }

    /* 聊天输入区：使用“输入框一行 + 底部工具条一行”的纵向布局 */
    .input-container {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
    }

    /* 统一触控按钮尺寸 */
    .settings-btn,
    .conversations-btn,
    .attach-btn { width: var(--tap); height: var(--tap); }

    /* 胶囊开关高度与标签字号微调；移动端仅保留图标 */
    .pill-toggle { height: 40px; width: var(--tap); padding: 0; justify-content: center; }
    .pill-toggle .label { font-size: 0.95rem; display: none; }

    /* 取消旧网格布局对开关与按钮位置的强绑定，让它们在底部工具条内自然排布 */
    #thinkingInlineToggle,
    #webInlineToggle,
    #attachBtn,
    #sendBtn,
    #stopBtn,
    .message-input {
        grid-column: auto;
        grid-row: auto;
        justify-self: auto;
    }

    /* 消息操作按钮更易点，避免遮挡内容 */
    .action-btn { width: 28px; height: 28px; font-size: 0.85rem; }
    /* 使消息左右内边距对称，同时将操作按钮定位到气泡外侧以保留正文最大可用宽度。
       做法：保持水平内边距对称（左右均为 8px），并把操作按钮用绝对定位移出气泡（右侧负偏移），
       保证视觉对称且不牺牲文本宽度。 */
    .message {
        padding: 10px 8px; /* top/bottom 10px, left/right 8px（对称） */
        font-size: clamp(0.95rem, 1vw + 0.15rem, 1rem);
        line-height: 1.45;
    }

    /* 将操作按钮放在气泡外侧（相对 .message 定位），以不占用文本流的可用宽度 */
    .message-actions {
        top: 6px;
        right: -36px; /* 负偏移将按钮移至气泡外侧，保留文本最大宽度 */
    }

    .action-btn {
        width: 26px;
        height: 26px;
        font-size: 0.8rem;
    }

    /* 在更窄屏（≤480px）使用略小的外侧偏移和按钮尺寸 */
    @media (max-width: 480px) {
        .message-actions { right: -32px; top: 4px; }
        .action-btn { width: 24px; height: 24px; font-size: 0.75rem; }
    }
}

/* 极小屏再压缩（超小设备） */
@media (max-width: 360px) {
    :root { --tap: 40px; --icon-lg: 1.15rem; --icon-md: 1.05rem; }
}

/* 移动端（宽度 ≤ 768px）：修复会话标题栏遮挡首条消息的问题
   - 在较窄屏幕下将 .session-title 设为固定定位，并为主聊天容器预留等高的顶部内边距
   - 兼容刘海/安全区，使用 env(safe-area-inset-top) 作为偏移基准 */
@media (max-width: 768px) {
  .session-title {
    position: fixed !important;
    top: env(safe-area-inset-top, 0px);
    left: 0;
    right: 0;
    margin: 0;
    width: 100%;
    max-width: 100%;
    /* 取消四角圆角，标题栏全直角 */
    border-radius: 0;
    z-index: 10000;
    /* 保持玻璃视觉但更实色，避免内容透出造成阅读遮挡感 */
    background: rgba(255,255,255,0.96);
    box-shadow: 0 6px 20px rgba(16,38,84,0.08);
    /* 允许高度自适应以展示模型徽章多行内容，同时保留最小高度供视觉一致性 */
    min-height: var(--session-title-height, 64px);
    height: auto;
    box-sizing: border-box;
    display: flex;
    align-items: center;
    padding: 8px 12px;
  }

  /* 为聊天容器预留与标题栏等高的空间，避免被遮挡 */
  .chat-container {
    padding-top: calc(var(--session-title-height, 64px) + env(safe-area-inset-top, 0px));
  }
}

/* 响应式调整 */
@media (max-width: 480px) {
    .message {
        max-width: 94%;
    }

    .conversation-actions {
        flex-direction: column;
    }
}

/* 动画减少偏好：降低动画强度 */
@media (prefers-reduced-motion: reduce) {
    * { animation: none !important; transition: none !important; }
}

/* 模态与遮罩样式（新建会话分组选择） */
/* 隐藏清空日志按钮（主聊页与会话管理页共用）；如需恢复可删除本规则 */
#clearLogsBtn { display: none !important; }

/* 抽屉安全区适配：避免刘海/打孔/底部手势条遮挡（Android/iOS WebView 兼容） */
@supports (padding-top: env(safe-area-inset-top)) {
    .drawer {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
    }
    .drawer-list {
        padding-bottom: calc(12px + env(safe-area-inset-bottom));
    }
    .drawer-footer {
        padding-bottom: calc(10px + env(safe-area-inset-bottom));
    }
}
@supports (padding-top: constant(safe-area-inset-top)) {
    .drawer {
        padding-top: constant(safe-area-inset-top);
        padding-bottom: constant(safe-area-inset-bottom);
    }
    .drawer-list {
        padding-bottom: calc(12px + constant(safe-area-inset-bottom));
    }
    .drawer-footer {
        padding-bottom: calc(10px + constant(safe-area-inset-bottom));
    }
}

/* 抽屉底部设置图标按钮（替代文字链接） */
.drawer-icon-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: var(--tap);
    height: var(--tap);
    border: 1px solid var(--border);
    border-radius: 12px;
    background: rgba(255,255,255,0.75);
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
    color: #08327a;
    text-decoration: none; /* 去除链接下划线 */
    text-decoration-skip-ink: none;
}
.drawer-icon-btn i { font-size: var(--icon-lg); }
.drawer-icon-btn:hover {
    background: rgba(255,255,255,0.9);
    box-shadow: 0 8px 18px rgba(16,38,84,0.10);
}

/* 打开抽屉时隐藏左上角历史会话悬浮按钮，避免与抽屉内容冲突 */
body.drawer-open .conversations-fab {
    display: none;
}
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: none; /* 通过脚本切换为 flex */
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.35);
    z-index: 2147483647;
}

.modal {
    background: #ffffff;
    border-radius: 12px;
    padding: 16px;
    width: min(92vw, 420px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    z-index: 2147483648;
}

.modal-title {
    font-size: 1rem;
    font-weight: 600;
    color: #1d1d1f;
    margin-bottom: 8px;
}

.modal-desc {
    font-size: 0.9rem;
    color: #555;
    margin: 6px 0 10px;
}

.modal-select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    outline: none;
    font-size: 0.95rem;
    background: linear-gradient(180deg, #ffffff, #fbfdff);
}

.modal-input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    outline: none;
    font-size: 0.95rem;
    background: #fff;
    margin-bottom: 10px;
}

.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    margin-top: 12px;
}

.modal-actions button {
    border: 1px solid #e0e0e0;
    background: #fff;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
}

#groupModalConfirmBtn {
    background-color: #007aff;
    color: #fff;
    border-color: #007aff;
}

/* 覆盖式抽屉与遮罩（会话管理） */
.drawer-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.35);
    display: none;
    /* 提高遮罩层层级，使其在标题栏之上（但低于抽屉） */
    z-index: 11000;
}
.drawer-overlay.open { display: block; }

.drawer {
    position: fixed;
    top: 0;
    left: 0;
    height: 100%;
    width: var(--drawer-width);
    transform: translateX(-100%);
    transition: transform 0.22s ease-out;
    background: var(--surface);
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
    border-right: 1px solid var(--border);
    box-shadow: var(--shadow);
    /* 确保抽屉在所有全局固定元素之上（比如顶部标题栏） */
    z-index: 11001;
    display: flex;
    flex-direction: column;
}
.drawer.open { transform: translateX(0); }

/* 允许抽屉内滚动在移动端平滑滚动（iOS momentum）并限制溢出行为 */
.drawer {
    touch-action: auto;
    overscroll-behavior: contain;
}

@media (min-width: 960px) {
    .drawer-overlay {
        display: none !important;
    }
    .drawer {
        position: relative;
        height: auto;
        transform: none !important;
        width: 100%;
        max-height: calc(100vh - 180px);
        border-radius: var(--radius);
        border: 1px solid var(--border);
        box-shadow: var(--shadow);
    }
    .drawer.open {
        transform: none;
    }
}

.drawer-header {
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    border-bottom: 1px solid var(--border);
}
.drawer-header {
    /* 固定在抽屉顶部，搜索与新建会话保持可见，其余内容在 .drawer-list 中滚动 */
    position: sticky;
    top: 0;
    z-index: 11002;
    background: var(--surface);
    /* 保持与抽屉视觉一致，避免内容透出时看见下层 */
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
}
.model-badge {
    display: inline-block;
    background: rgba(0,0,0,0.06);
    color: var(--fg);
    font-size: 0.78rem;
    padding: 4px 8px;
    border-radius: 999px;
    max-width: 160px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.modal-label {
    font-size: 0.9rem;
    color: var(--muted);
    display: block;
    margin-bottom: 6px;
}
.conversation-model {
    font-size: 0.85rem;
    color: var(--muted);
    margin-top: 6px;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.session-model {
    font-size: 0.9rem;
    color: var(--muted);
    margin-top: 6px;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    text-align: right;
}
.session-title .session-name-row {
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap; /* 不换行 */
}
.session-title .session-name {
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.session-title .memory-badge {
    padding: 0;
    width: 20px;
    height: 20px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border: none;
    margin-left: 4px;
}
.session-title .memory-badge .memory-spinner {
    width: 16px;
    height: 16px;
}

.memory-spinner::before {
    content: "";
    position: absolute;
    left: 3px;
    top: 3px;
    right: 3px;
    bottom: 3px;
    border-radius: 50%;
    background: var(--surface, #fff);
}

.memory-spinner.spinning {
    animation: memory-spin 1s linear infinite;
}

/* 完成态：整圆环（SVG）样式 */
.memory-done {
    width: 16px;
    height: 16px;
    display: inline-block;
}
.memory-done circle {
    fill: none;
    stroke: #007aff;
    stroke-width: 2;
}
.drawer-section { /* 兼容：保持抽屉内 section 默认样式 */ }
.drawer-primary {
    background: linear-gradient(135deg, var(--brand), var(--brand-2));
    color: #fff;
    border: none;
    border-radius: 10px;
    padding: 10px 12px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 6px 16px rgba(47,111,228,0.18);
}
.drawer-search {
    width: 100%;
    padding: 10px 12px;
    border-radius: 10px;
    border: 1px solid rgba(13,71,161,0.12);
    background: #fff;
    outline: none;
    font-size: 0.95rem;
}
.drawer-list {
    flex: 1;
    overflow-y: auto;
    padding: 10px 8px 12px 8px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}
/* 平滑滚动支持 */
.drawer-list {
    -webkit-overflow-scrolling: touch;
}
/* 极窄的高级感滚动条（仅作用于抽屉列表） */
.drawer-list {
    /* Firefox */
    scrollbar-width: thin;
    scrollbar-color: rgba(16,38,84,0.22) transparent;
}
.drawer-list::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}
.drawer-list::-webkit-scrollbar-track {
    background: transparent;
}
.drawer-list::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, rgba(16,38,84,0.22), rgba(16,38,84,0.12));
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.04);
    box-shadow: inset 0 2px 6px rgba(16,38,84,0.06);
}
.drawer-list::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, rgba(16,38,84,0.36), rgba(16,38,84,0.22));
}
.drawer .conversation-summary-content,
.drawer .group-memory {
    /* 仅影响抽屉内的记忆窗格：换行并占满抽屉可用宽度 */
    flex-basis: 100%;
    width: 100%;
    box-sizing: border-box;
    margin: 6px 0;
    /* 不限制高度、不使用内部滚动，交由 .drawer-list 整体滚动以满足“展开后整体上下滑动”的需求 */
    /* 若未来需要局部滚动，可在此处恢复 max-height/overflow-y 设置 */
}
.drawer .drawer-item {
    /* 允许抽屉内会话项换行，使记忆窗格独占一行而不与按钮同行 */
    display: flex;
    flex-wrap: wrap;
    align-items: flex-start;
}
.drawer .drawer-item > div:first-child {
    /* 抽屉内左侧主信息区域可收缩，防止溢出 */
    flex: 1 1 auto;
    min-width: 0;
}
.drawer-section {
    border: 1px solid rgba(13,71,161,0.06);
    border-radius: 10px;
    /* 允许子内容扩展并推动后续元素，避免展开时与邻居遮盖（prior overflow:hidden 导致可视裁剪与覆盖问题） */
    overflow: visible;
    background: linear-gradient(180deg, rgba(255,255,255,0.8), rgba(245,248,255,0.6));
}
.drawer-section summary {
    list-style: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    font-weight: 600;
    color: #08327a;
    background: linear-gradient(90deg, rgba(0,122,255,0.06), rgba(88,86,214,0.04));
}
.drawer-section summary .summary-line { display: inline-flex; align-items: center; gap: 6px; }
.drawer-section summary i { font-size: var(--icon-sm); color: #08327a; }
.drawer-items {
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 8px;
}
.drawer-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    -webkit-backdrop-filter: blur(var(--blur)) saturate(140%);
    backdrop-filter: blur(var(--blur)) saturate(140%);
}
.drawer-item .name {
    color: #082a8a;
    font-weight: 600;
    font-size: 0.95rem;
}
.drawer-item .time {
    color: #4b5563;
    font-size: 0.82rem;
}
.drawer-item .actions {
    display: flex;
    gap: 6px;
}
/* 若在某些地方仍使用文字按钮，可套用 .text-btn */
.drawer-item .actions .text-btn {
    border: 1px solid rgba(13,71,161,0.12);
    background: #fff;
    color: #08327a;
    border-radius: 8px;
    padding: 6px 8px;
    cursor: pointer;
}
.drawer-footer {
    padding: 10px 12px;
    border-top: 1px solid var(--border);
    display: flex;
    gap: 10px;
    justify-content: space-between;
}
.drawer-link {
    color: #08327a;
    text-decoration: underline;
    font-weight: 600;
}

/* 欢迎区（空会话时显示） */
.welcome-hero {
    display: none;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: center;
    gap: 10px;
    padding: 40px 10px 20px 10px;
}
.welcome-brand-line {
    display: inline-flex;
    align-items: center;
    gap: 10px;
}
.welcome-logo {
    height: 48px;
    width: auto;
    border-radius: 10px;
}
.welcome-title {
    font-size: clamp(20px, 2.6vw, 28px);
    font-weight: 700;
    color: #1d1d1f;
}
.welcome-subtitle {
    color: var(--muted);
}
.welcome-suggestions {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
    margin-top: 8px;
    width: min(680px, 100%);
}
.welcome-suggestions .suggest {
    border: 1px solid var(--border);
    background: #fff;
    border-radius: 10px;
    padding: 10px 12px;
    text-align: left;
    cursor: pointer;
    transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
}
.welcome-suggestions .suggest:hover {
    transform: translateY(-1px);
    box-shadow: 0 8px 20px rgba(16,38,84,0.12);
    background: linear-gradient(180deg, #ffffff, #fbfdff);
}

@media (max-width: 480px) {
    .welcome-suggestions { grid-template-columns: 1fr; }
}